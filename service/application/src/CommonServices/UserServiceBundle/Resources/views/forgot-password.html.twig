{% extends "layout.html.twig" %}

{% block title %} Register new user {% endblock %}


{% block head %}
{{ parent() }}

{% block css_code %}
{% stylesheets
'@UserServiceBundle/Resources/web/css/signin-register.css'

filter='cssrewrite'
%}
<link rel="stylesheet" type="text/css" href="{{ asset_url }}" />
{% endstylesheets %}
{% endblock %}

{% endblock %}


{% block content %}


<div id="loginbox"  class="mainbox ">
    <div class="panel panel-info" >
        <div class="panel-heading">
            <div class="panel-title">Reset password</div>
        </div>

        <div class="panel-body" >
            <div class="messages"></div>

            <form id="loginform" class="form" role="form">

                <div class="form-group">
                    <label for="email" class=" control-label">Email / Mobile number</label>
                    <input type="text" class="form-control" id="email" name="email" type="email" placeholder="Email Address / Mobile number">
                </div>

                <div class="form-group">
                    <!-- Button -->
                    <div class=" controls">
                        <a  href="#" class="btn btn-success"> <i class="fa fa-lock"></i> Submit  </a>
                    </div>
                </div>

            </form>

        </div>
    </div>
    <div class="right_bg">
        {% image '@UserServiceBundle/Resources/web/images/login_bg.jpg' %}
        <img src="{{ asset_url }}"  alt="BeeStock" class="img-responsive" />
        {% endimage %}
    </div>
</div>


{% endblock %}

{% block footer %}
{{ parent() }}

<script>
    // will take values from translation messages and pass it to register.js file
    var error_messages = {
        email  : {
            empty : 'Please supply your email',
            failed : 'Please supply valid email address'
        }

    }
    submitionlink = '{{ forgotPasswordLink }}';
</script>

<script src="{{ asset("js/bootstrapvalidator.min.js") }}" ></script>





<script>
    var myForm = $('#loginform');
    var myFormId = 'loginform';

    //validation
    $(document).ready(function() {
        myForm.bootstrapValidator({
            // To use feedback icons, ensure that you use Bootstrap v3.1.0 or later
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitHandler: function(validator, form, submitButton) {
                $.ajax({
                    type: 'POST',
                    url: submitionlink,
                    data: $(form).serialize(),
                    success: function(result) {
                        console.log("registered successfully and should redirect with logged in");
                        $('#'+myFormId+' .messages').html('<div id="signupaler-2" class="alert alert-success">\
                                                <span> '+result.response.user.uuid+'</span>\
                                            </div>');
                        myForm.data('bootstrapValidator').resetForm();
                        myForm.hide();
                    }
                })
                    .fail(function(result) {
                        $('#'+myFormId+' .messages').html('');
                        $.each( result.responseJSON.error.details , function( key, value ) {
                            console.log( key + ": " + value.message );
                            myForm.prepend('<div id="signupaler-2" class="alert alert-danger">\
                                            <span> '+value.message+'</span>\
                                        </div>');
                        });
                    })
                return false;
            },
            fields: {
                email: {
                    validators: {
                        notEmpty: {
                            message: error_messages.email.empty
                        },
                        emailAddress: {
                            message: error_messages.email.failed
                        }
                    }
                }
            }
        })
    });

</script>


{% endblock %}